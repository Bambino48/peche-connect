<section class="add-product-page">
  <h1>Ajouter un produit</h1>
  <p class="subtitle">
    Renseignez les informations sur votre produit de pÃªche
  </p>

  <div class="form-card">
    <!-- Toast -->
    <div *ngIf="showToast" class="toast" [ngClass]="toastType">
      {{ toastMessage }}
    </div>

    <!-- Message de succÃ¨s -->
    <div *ngIf="successMessage" class="success-banner">
      {{ successMessage }}
    </div>

    <!-- Message d'erreur -->
    <div *ngIf="errorMessage" class="error-banner">
      âš ï¸ {{ errorMessage }}
    </div>

    <form [formGroup]="productForm" (ngSubmit)="submitProduct()">

      <div class="form-group">
        <label>Type de poisson</label>
        <select formControlName="fishType" required>
          <option value="">-- Choisir --</option>
          <option value="THON">Thon</option>
          <option value="TILAPIA">Tilapia</option>
          <option value="CAPITAINE">Capitaine</option>
          <option value="CREVETTE">Crevette</option>
          <option value="AUTRE">Autre</option>
        </select>
      </div>

      <div class="form-group" *ngIf="productForm.get('fishType')?.value === 'AUTRE'">
        <label>Autre poisson</label>
        <input type="text" formControlName="otherFishName" placeholder="PrÃ©cisez"
          [required]="productForm.get('fishType')?.value === 'AUTRE'" />
      </div>

      <div class="form-group">
        <label>Nom local</label>
        <input type="text" formControlName="localFishName" placeholder="Nom local du poisson" />
      </div>

      <div class="form-group">
        <label>QuantitÃ© (kg) (min 0.01)</label>
        <input type="number" formControlName="quantityKg" required min="0.01" step="0.01" />
      </div>

      <div class="form-group">
        <label>Prix par kg (min 0.01)</label>
        <input type="number" formControlName="pricePerKg" required min="0.01" step="0.01" />
      </div>

      <div class="form-group">
        <label>Date de pÃªche</label>
        <input type="date" formControlName="fishingDate" required />
      </div>

      <div class="form-group">
        <label>Zone de pÃªche</label>
        <select formControlName="fishingZone" required>
          <option value="">-- Choisir --</option>
          <option value="MER">Mer</option>
          <option value="LAGUNE">Lagune</option>
          <option value="FLEUVE">Fleuve</option>
        </select>
      </div>

      <div class="form-group">
        <label>MÃ©thode de conservation</label>
        <select formControlName="conservationMethod">
          <option value="">-- Choisir --</option>
          <option value="GLACE">Glace</option>
          <option value="FRAIS">Frais</option>
          <option value="CONGELE">CongelÃ©</option>
        </select>
      </div>

      <div class="form-group photo-field">
        <label>Photo (URL)</label>
        <input type="hidden" formControlName="photoUrl" required />
        <button type="button" class="btn-secondary" (click)="openCamera()">
          ğŸ“· Prendre une photo
        </button>
        <div *ngIf="isCameraOpen" class="camera-section">
          <video #video autoplay playsinline muted></video>
          <canvas #canvasElement hidden></canvas>
          <div class="form-actions">
            <button type="button" class="btn-primary" (click)="capturePhoto()">
              ğŸ“¸ Capturer
            </button>
            <button type="button" class="btn-primary" (click)="savePhoto()" [disabled]="!pendingPhotoDataUrl">
              ğŸ’¾ Enregistrer la photo
            </button>
            <button type="button" class="btn-secondary" (click)="stopCamera()">
              âŒ Fermer
            </button>
          </div>
        </div>
        <div *ngIf="!isCameraOpen && photoPreviewUrl" class="photo-preview">
          <img [src]="photoPreviewUrl" alt="AperÃ§u photo" />
        </div>
      </div>

      <div class="form-group">
        <label>Statut</label>
        <select formControlName="status" required>
          <option value="ACTIF">Actif</option>
          <option value="VENDU">Vendu</option>
          <option value="DESACTIVE">DÃ©sactivÃ©</option>
        </select>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary" [disabled]="isSubmitting || productForm.invalid || !photoSaved">
          {{ isSubmitting ? 'Enregistrement...' : 'Enregistrer' }}
        </button>

        <button type="button" class="btn-secondary" (click)="goBack()">
          Retour
        </button>
      </div>

    </form>
  </div>
</section>